# 知乎（仿写版）

## 引言

这是第一次综合运用多种之前学的go语言知识进行的小型项目开发。有许多不完善的地方，发现自己在go语言方面仍有很多不足。无法迅速准确地完成自己想要的功能，有许多东西都需要学习，对于此次考核来说，个人感觉表现的非常差劲，远没有达到预期标准。

但是，考核虽然结束了，不代表项目就会结束。我会在后续持续完善，添加一些新的功能，希望能真正的部署运行起自己的一个项目，我相信对于我来说，是十分有挑战的，但是我会继续努力的。

## 功能

仿造知乎进行一些基础功能的仿写

用户的注册、登录，用户名和密码的修改。

提出问题，回答问题，发表文章

对回答和文章进行评论，收藏自己喜欢的文章和问题等等

## 项目分层（项目脚手架）

### CLD分层模式

采用的是CLD框架（简易版）结构

Controller，控制层，与上述类似，服务入口，负责处理路由，参数校验，请求转发。

Logic/Service，业务逻辑（服务）层，一般是业务逻辑的入口，可以认为从这里开始，所有的请求参数一定是合法的。业务逻辑和业务流程也都在这一层中。常见的设计中会将该层称为 Business Rules。

DAO/Repository，DAO层，这一层主要负责和数据、存储打交道。将下层存储以更简单的函数、接口形式暴露给 Logic 层来使用。负责数据的持久化工作。

第一次运用该框架，第一听鑫哥讲解的时候，是一脸懵，在寒假的学习中，逐步了解并初步应用，应该还是有许多不规范的地方，但也是尽力而为了。

## web框架

### Gin框架

采用的是最初级最易上手的gin框架

Gin是一个golang的微框架，封装比较优雅，API友好，源码注释比较明确。具有快速灵活，容错方便等特点。其实对于golang而言，web框架的依赖要远比Python，Java之类的要小。自身的net/http足够简单，性能也非常不错。框架更像是一些常用函数或者工具的集合。借助框架开发，不仅可以省去很多常用的封装带来的时间，也有助于团队的编码风格和形成规范。

目前在很多使用Golang的中小型公司中进行业务开发，使用Gin框架的很多

Gin框架源码地址：https://github.com/gin-gonic/gin

Gin框架文档地址：https://gin-gonic.com/zh-cn/docs/


## 数据库

### MySQL

该项目运用MySQL作为数据库，进行数据储存和数据反馈

MySQL是一个关系型数据库管理系统，由瑞典MySQL AB 公司开发，属于 Oracle 旗下产品。MySQL 是最流行的关系型数据库管理系统关系型数据库管理系统之一，在 WEB 应用方面，MySQL是最好的 RDBMS (Relational Database Management System，关系数据库管理系统) 应用软件之一。

第一次运用外键进行数据库表与表之间的链接，应用效果并不理想，出现许多报错，仍未得到解决。gorm对外键进行关联，这部分仍是薄弱。

## 配置

### viper

采用viper进行项目的配置信息管理。

[Viper](https://github.com/spf13/viper)是适用于Go应用程序的完整配置解决方案。它被设计用于在应用程序中工作，并且可以处理所有类型的配置需求和格式。

鉴于`viper`库本身的README已经写得十分详细，这里就将其翻译成中文，并在最后附上两个项目中使用`viper`的示例代码以供参考。

### 日志（zap）

通过zap就能实现更为全面的日志信息管理。

在许多Go语言项目中，我们需要一个好的日志记录器能够提供下面这些功能：

- 能够将事件记录到文件中，而不是应用程序控制台。
- 日志切割-能够根据文件大小、时间或间隔等来切割日志文件。
- 支持不同的日志级别。例如INFO，DEBUG，ERROR等。
- 能够打印基本信息，如调用文件/函数名和行号，日志时间等。

## 中间件

### Cors

CORS 是一种基于 [HTTP Header](https://link.juejin.cn?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fen-US%2Fdocs%2FGlossary%2FHeader) 的机制，该机制通过允许服务器标示除了它自己以外的其它域。服务器端配合浏览器实现 `CORS` 机制，可以突破浏览器对跨域资源访问的限制，实现跨域资源请求。

采用cors中间件，解决跨域问题

### JWT

#### 什么是JWT？

JWT全称JSON Web Token是一种跨域认证解决方案，属于一个开放的标准，它规定了一种Token 实现方式，目前多用于前后端分离项目和 OAuth2.0 业务场景下。

#### 为什么需要JWT？

在之前的一些web项目中，我们通常使用的是`Cookie-Session`模式实现用户认证。相关流程大致如下：

1. 用户在浏览器端填写用户名和密码，并发送给服务端
2. 服务端对用户名和密码校验通过后会生成一份保存当前用户相关信息的session数据和一个与之对应的标识（通常称为session_id）
3. 服务端返回响应时将上一步的session_id写入用户浏览器的Cookie
4. 后续用户来自该浏览器的每次请求都会自动携带包含session_id的Cookie
5. 服务端通过请求中的session_id就能找到之前保存的该用户那份session数据，从而获取该用户的相关信息。

这种方案依赖于客户端（浏览器）保存 Cookie，并且需要在服务端存储用户的session数据。

在移动互联网时代，我们的用户可能使用浏览器也可能使用APP来访问我们的服务，我们的web应用可能是前后端分开部署在不同的端口，有时候我们还需要支持第三方登录，这下`Cookie-Session`的模式就有些力不从心了。

JWT就是一种基于Token的轻量级认证模式，服务端认证通过后，会生成一个JSON对象，经过签名后得到一个Token（令牌）再发回给用户，用户后续请求只需要带上这个Token，服务端解密之后就能获取该用户的相关信息了。

